<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Slide Show by Rod</title>
  <link rel="stylesheet" href="css/slideshow.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
</head>
<body>


<a class="js-open-modal btn" href="#" config-id="config-id" title="Configuration"><i class="fa fa-cog" style="color:green;"></i></a>

<div id="configurationSlideShow" style="display:none">
  <input type='file' accept='application/JSON' onchange='openFile(event)'><br>
  <a class="js-open-modal btn" href="#" start-slideshow-id="start-slideshow" title="Start"><i class="fa fa-play-circle" style="color:green;"></i></a>
  <br><br>
  <label for="fname"><i class="fa fa-film" style="color:green;"></i></label>                                            
  <input type="text" id="idSlideShow" value="0" size="1" pattern="[0-9]{3}" style="color:green;">
  <a class="js-open-modal btn" href="#" set-slideshow-id="set-slideshow" title="Sauvegarder"><i class="fa fa-rotate-left" style="color:green;"></i></a>
  <br/>
  <a class="js-open-modal btn" href="slideshowTools.html" add-media="add-media" title="Ajout M‚dia"><i class="fa fa-briefcase" style="color:green;"></i></a>
  
</div>


<div id="textes" style="display:none">
<div class="fade"></div>
<section class="star-wars">
  <div class="crawl" id ="divCrawl">
    <div class="title">
      <p id="starwarsTitle">Episode IV</p>
      <h1 id="starwarsSubTitle">A New Hope</h1>
    </div>
    <p>It is a period of civil war. Rebel spaceships, striking from a hidden base, have won their first victory against the evil Galactic Empire.</p>      
    <p>During the battle, Rebel spies managed to steal secret plans to the Empire’s ultimate weapon, the DEATH STAR, an armored space station with enough power to destroy an entire planet.</p>
    <p>Pursued by the Empire’s sinister agents, Princess Leia races home aboard her starship, custodian of the stolen plans that can save her people and restore freedom to the galaxy…</p>
  </div>
</section>  
</div>

<div id="images" style="display:none">
  <center>
    <img id="srcImage" src=""/>
  </center>
</div>
<div id="videos" style="display:none">
  <center>
  <video id="video" width="1280" height="720"  controls>
      <source id="srcVideo" src="" type="video/mp4">
  </video>
  </center>
</div>
<div id="musics" style="display:none">
  <audio id="music" controls>
    <source id="srcMusic" src="" type="audio/mpeg">
  </audio>
</div>
 
<script>
function hideAll(){
    $('#srcVideo').attr('src','');
    $('#videos').hide();
    $('#images').hide();
    $('#musics').hide();
    $('#textes').hide();
    $('#configurationSlideShow').hide();
}

function stopMusic(){
    $('#music').get(0).pause();
    $('#srcMusic').attr('src','');
}

var datas;
var currentData;
var id;

(function($) {
  $(document).ready(function(){
    id=0;
    // ajout du listener
    $('#video').get(0).addEventListener('pause', function(e) {
              $('#video').get(0).webkitExitFullscreen();
              id++;
              runAnimation();
    });
  });
})(jQuery);

var openFile = function(event) {
        var input = event.target;
        var reader = new FileReader();
        reader.onload = function(){
          slideShowDatas = JSON.parse(reader.result);
        };
        reader.readAsText(input.files[0]);
      };

$('a[start-slideshow-id]').click(function(e) {
   runAnimation();
});

$('a[config-id]').click(function(e) {
   $('#configurationSlideShow').toggle();
});
$('a[set-slideshow-id]').click(function(e) {
   id =$('#idSlideShow').val();
});


function runAnimation(){
  hideAll();
  if (id>=slideShowDatas.length){
    console.log('fini');
    return null;
  }
  currentData=slideShowDatas[id];
  switch (currentData.media)
  {
    case "mp3":
         playMusic();
         break;
    case "mp4":
         stopMusic();
         playMovie();
         break;
    case "img":
         playImage();
         break;
    case "txt":
         playText();
         break; 
    defaut:
         break;    
  }
}

function playImage(){
  $('#srcImage').attr('src',currentData.file);
  $('#srcImage').attr('width',currentData.width);
  $('#srcImage').attr('height',currentData.height);
  $('#images').show();
  id++;
  window.setTimeout( runAnimation, currentData.duration*1000);
};

function playMovie(){
    $('#srcVideo').attr('src',currentData.file);
    $('#video')[0].load();
    $('#videos').show();
    //$('#video').get(0).requestFullscreen();
    $('#video').get(0).play();
    
}
  
function playMusic(){
  $('#srcMusic').attr('src',currentData.file);
  $('#music')[0].load();
  //$('#musics').show();
  $('#music').get(0).play();
  id++;
  runAnimation();
};

function playText(){
  var div_data ='<div class="title">'
  + '<p>'+currentData.title+'</p>'
  + '<h1>'+currentData.subTitle+'</h1></div>' ;
  currentData.lines.forEach(object => div_data=div_data+'<p>'+object.line+'<p>');
  div_data=div_data+"</div>"                     

  $("#divCrawl").html(div_data);                     
  $('#textes').show(); 
  id++;
  window.setTimeout( runAnimation, currentData.duration*1000);
};

</script>
 
</body>
</html>